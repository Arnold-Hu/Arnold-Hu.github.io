<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="学习 感悟 精炼 内化"><title>2048 ai小试 | 巴别塔</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">2048 ai小试</h1><a id="logo" href="/.">巴别塔</a><p class="description">每天搭块砖～ 每天向上爬～</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/timeline/"><i class="fa fa-archive"> timeline</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">2048 ai小试</h1><div class="post-meta">Jul 26, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/07/26/2048-ai小试/" href="/2016/07/26/2048-ai小试/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>最近无聊在看书的时候看到了博弈树，以及最大最小剪枝算法(alpha-beta pruning method)。脑子里想着怎么实践一下来加深对这个算法的理解，然后想到了以前刚好试过2048的ai，但是失败了，而这个算法的适用场景刚好合适，可以试试，然后就开始coding了。完整的代码见<a href="https://github.com/Arnold-Hu/garage/blob/master/2048/ai_2048.py" target="_blank" rel="external">我的github</a></p>
<h2 id="2048-简介"><a href="#2048-简介" class="headerlink" title="2048 简介"></a>2048 简介</h2><p>这个直接贴个游戏网址比简单的文字介绍方便多了。<a href="http://2048game.com" target="_blank" rel="external">点此试玩</a>。</p>
<p>我们现在可以把这个抽象到代码里变成一个类。假设这个类是一个n*n的矩阵，那么这个类至少有下面的方法</p>
<ol>
<li>4个方向的移动，及消除</li>
<li>检查所有可以移动的方向，没有的话判定结束</li>
<li>在空白位置随机生成一个2/4</li>
<li>初始化(包括拷贝和直接初始化)</li>
</ol>
<p>这就足以满足没有ai的玩法了。</p>
<p>Python代码如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Matrix</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, matrix=None, size=<span class="number">4</span>, start_unit=<span class="number">3</span>, data=None, flag=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">"""初始化，包括自动初始化，给定矩阵初始化和直接copy初始化"""</span></span><br><span class="line">        <span class="comment"># self.ava_move = []</span></span><br><span class="line">        self.score = <span class="keyword">None</span></span><br><span class="line">        self.empty_list = set()</span><br><span class="line">        self.start_unit = start_unit</span><br><span class="line">        self.size = size</span><br><span class="line">        self.flag = flag       <span class="comment"># 0-&gt;min 1-&gt;max</span></span><br><span class="line">        self.from_direction = <span class="keyword">None</span></span><br><span class="line">        self.ava_move = set()</span><br><span class="line">        self.dead = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            self.data = np.copy(data)</span><br><span class="line">            self._refresh_empty_list()</span><br><span class="line">            self.size = len(data)</span><br><span class="line">            self.check_move()</span><br><span class="line">        <span class="keyword">elif</span> matrix <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            self.data = np.copy(matrix.data)</span><br><span class="line">            self.empty_list = copy.copy(matrix.empty_list)</span><br><span class="line">            self.size = matrix.size</span><br><span class="line">            self.start_unit = matrix.start_unit</span><br><span class="line">            self.flag = matrix.flag</span><br><span class="line">            self.ava_move = copy.copy(matrix.ava_move)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._gen_data()</span><br><span class="line">            self.check_move()</span><br><span class="line">            <span class="comment"># self.check_avaliable_move()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_gen_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.data = np.zeros([self.size, self.size], dtype=int)</span><br><span class="line">        map(</span><br><span class="line">            <span class="keyword">lambda</span> x: self.empty_list.add(x),</span><br><span class="line">            [(i, j) <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size) <span class="keyword">for</span> j <span class="keyword">in</span> range(self.size)]</span><br><span class="line">        )</span><br><span class="line">        sample = random.sample(self.empty_list, self.start_unit)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sample:</span><br><span class="line">            self.data[item] = <span class="number">1</span></span><br><span class="line">            self.empty_list.remove(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, direction)</span>:</span></span><br><span class="line">        <span class="string">"""</span><br><span class="line">        0 -&gt; move up</span><br><span class="line">        1 -&gt; move right</span><br><span class="line">        2 -&gt; move down</span><br><span class="line">        3 -&gt; move left</span><br><span class="line">        """</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size):</span><br><span class="line">            <span class="keyword">if</span> direction == <span class="number">0</span>:</span><br><span class="line">                self.data[:, i] = self._line_push(self.data[:, i], <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> direction == <span class="number">1</span>:</span><br><span class="line">                self.data[i, :] = self._line_push(self.data[i, :], <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> direction == <span class="number">2</span>:</span><br><span class="line">                self.data[:, i] = self._line_push(self.data[:, i], <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> direction == <span class="number">3</span>:</span><br><span class="line">                self.data[i, :] = self._line_push(self.data[i, :], <span class="number">1</span>)</span><br><span class="line">        self._refresh_empty_list()</span><br><span class="line">        self.flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_line_push</span><span class="params">(self, line, direction)</span>:</span></span><br><span class="line">        <span class="string">"""0 -&gt; right    1 -&gt; left"""</span></span><br><span class="line">        <span class="keyword">if</span> direction == <span class="number">1</span>:</span><br><span class="line">            zip_list = [x <span class="keyword">for</span> x <span class="keyword">in</span> line <span class="keyword">if</span> x != <span class="number">0</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(zip_list) - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> zip_list[i] == zip_list[i + <span class="number">1</span>]:</span><br><span class="line">                    zip_list[i] += <span class="number">1</span></span><br><span class="line">                    zip_list[i + <span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">            result = [x <span class="keyword">for</span> x <span class="keyword">in</span> zip_list <span class="keyword">if</span> x != <span class="number">0</span>]</span><br><span class="line">            result.extend([<span class="number">0</span>] * (len(line) - len(result)))</span><br><span class="line">            <span class="keyword">return</span> np.array(result)</span><br><span class="line">        <span class="keyword">if</span> direction == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> self._line_push(line[::<span class="number">-1</span>], <span class="number">1</span>)[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_refresh_empty_list</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""初始化或者push之后刷新空位置列表"""</span></span><br><span class="line">        self.empty_list = set()</span><br><span class="line">        map(</span><br><span class="line">            <span class="keyword">lambda</span> pair: self.empty_list.add(pair),</span><br><span class="line">            [(i, j) <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size) <span class="keyword">for</span> j <span class="keyword">in</span> range(self.size) <span class="keyword">if</span> self.data[(i, j)] == <span class="number">0</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_gen_random</span><span class="params">(self, pair=None, number=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> number <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            p = random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">            <span class="keyword">if</span> p == <span class="number">4</span>:</span><br><span class="line">                number = <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                number = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> pair <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            pair = random.sample(self.empty_list, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            self.data[pair] = number</span><br><span class="line">            self.empty_list.remove(pair)</span><br><span class="line">        <span class="keyword">elif</span> len(self.empty_list) != <span class="number">0</span>:</span><br><span class="line">            self.data[pair] = number</span><br><span class="line">            self.empty_list.remove(pair)</span><br><span class="line"></span><br><span class="line">        self.flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.check_move()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_move</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""查询下一步可以push的方向"""</span></span><br><span class="line">        move = set()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.size):</span><br><span class="line">                <span class="keyword">if</span> i == self.size - <span class="number">1</span> <span class="keyword">and</span> j == self.size - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">elif</span> i == self.size - <span class="number">1</span>:</span><br><span class="line">                    self._check_right(i, j, move)</span><br><span class="line">                <span class="keyword">elif</span> j == self.size - <span class="number">1</span>:</span><br><span class="line">                    self._check_down(i, j, move)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self._check_right(i, j, move)</span><br><span class="line">                    self._check_down(i, j, move)</span><br><span class="line">        self.ava_move = move</span><br><span class="line">        <span class="keyword">if</span> len(move) == <span class="number">0</span>:</span><br><span class="line">            self.dead = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_check_right</span><span class="params">(self, i, j, move_set)</span>:</span></span><br><span class="line">        left_value = self.data[i, j]</span><br><span class="line">        right_value = self.data[i, j + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> left_value == <span class="number">0</span> <span class="keyword">and</span> right_value &gt; <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">if</span> left_value &gt; <span class="number">0</span> <span class="keyword">and</span> right_value == <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> left_value == right_value <span class="keyword">and</span> left_value &gt; <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">1</span>)</span><br><span class="line">            move_set.add(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_check_down</span><span class="params">(self, i, j, move_set)</span>:</span></span><br><span class="line">        up_value = self.data[i, j]</span><br><span class="line">        down_value = self.data[i + <span class="number">1</span>, j]</span><br><span class="line">        <span class="keyword">if</span> up_value == <span class="number">0</span> <span class="keyword">and</span> down_value &gt; <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> up_value &gt; <span class="number">0</span> <span class="keyword">and</span> down_value == <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> up_value == down_value <span class="keyword">and</span> up_value &gt; <span class="number">0</span>:</span><br><span class="line">            move_set.add(<span class="number">0</span>)</span><br><span class="line">            move_set.add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.size):</span><br><span class="line">                value = self.data[i, j]</span><br><span class="line">                <span class="keyword">if</span> value == <span class="number">0</span>:</span><br><span class="line">                    s.append(<span class="string">'*\t'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    s.append(<span class="string">'%s\t'</span> % <span class="number">2</span>**value)</span><br><span class="line">            s.append(<span class="string">'\n'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.info()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = (<span class="string">"empty list: %s\nscore: %s\nava move: %s\nflag: %s\ndirection: %s\nmatrix data: \n%s"</span></span><br><span class="line">         % (self.empty_list, self.score, self.ava_move, self.flag, self.from_direction, self.__str__()))</span><br><span class="line">        <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure></p>
<p>这个类就足以表示最基本的操作，类里面还额外维护了一些东西比如空位置列表，可移动方向之类的来方便写代码。</p>
<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><h4 id="先来聊聊博弈树"><a href="#先来聊聊博弈树" class="headerlink" title="先来聊聊博弈树"></a>先来聊聊博弈树</h4><p>博弈树可以看下列文章，写的已经比较详细清楚了。</p>
<p><a href="http://ai.mindcont.com/Search-Based/博弈树的搜索.html" target="_blank" rel="external">博弈树的搜索</a></p>
<p>简而言之就是因为每一层都有最大最小的追求，而且度大于2，所以当一个结果出来之后就知道这整个子数都会被砍掉，后面都不用算了，打到减少计算量的目的。</p>
<p>其实，如果我们从数学上得到所有的分支结果的，但是在工程上并不能实现，尤其是像围棋这种深度爆炸的游戏，即使用全宇宙的每个原子来表示一个状态都不够 = =</p>
<p>所以我们得另外想一个办法来处理这个问题。首先容易想到的就是我们有一个评估方法来得到当前场景的分数，那么我们就可以直搜索到一定的深度而不用一直搜索到最终状态。然后就可以愉快的用最大最小剪枝算法了。我自然只能用自己的低智商实现这个方法。</p>
<p>这个算法的关键是如何计算这个分数，作为一个有追求的人，我当然第一个想到设计几个参数来机器学习，然而我发现跑一次得20分钟的时候我就默默放弃了T——T。最后还是拍脑袋用了一个启发式的算法来模拟人的走法。即希望这个局面在下面几个方面表现良好：</p>
<ol>
<li>最大的在角落</li>
<li>每行每列都单调</li>
<li>空位多</li>
</ol>
<p>反正是拍脑袋的，效果也勉强过得去，因为运算的效率比较低，试了10盘，9盘能到2048，4盘能到4096，从没到过8192。</p>
<p>代码中计算分数部分<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.dead:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1000000000</span></span><br><span class="line">    score_sum = <span class="number">0</span></span><br><span class="line">    full = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size):</span><br><span class="line">        score_sum += self._line_score(self.data[i, :])</span><br><span class="line">        score_sum += self._line_score(self.data[:, i])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(self.size):</span><br><span class="line">            result = <span class="number">0</span></span><br><span class="line">            result += self._compute_unit_score2(i, j)</span><br><span class="line">            score_sum += result</span><br><span class="line">            <span class="keyword">if</span> self.data[i, j] &gt; <span class="number">0</span>:</span><br><span class="line">                full += <span class="number">1</span></span><br><span class="line">    score_sum += full**<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> score_sum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_compute_unit_score2</span><span class="params">(self, i, j)</span>:</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    value = self.data[i, j]</span><br><span class="line">    bundary = (<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> bundary:</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> bundary:</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> value ** index</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_line_score</span><span class="params">(line)</span>:</span></span><br><span class="line">    l1 = sorted(line)</span><br><span class="line">    l2 = sorted(line, reverse=<span class="keyword">True</span>)</span><br><span class="line">    score1 = sum([abs(a - b)**<span class="number">2</span> <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(line, l1)])</span><br><span class="line">    score2 = sum([abs(a - b)**<span class="number">2</span> <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(line, l2)])</span><br><span class="line">    <span class="keyword">return</span> min(score1, score2) * np.mean(line)</span><br></pre></td></tr></table></figure></p>
<p>求ai下一步的算法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choose_direction</span><span class="params">(node, depth=<span class="number">2</span>, has_log=False)</span>:</span></span><br><span class="line">    <span class="comment"># global depth_sum</span></span><br><span class="line">    <span class="comment"># depth_sum += depth</span></span><br><span class="line">    best_direction = <span class="number">-1</span></span><br><span class="line">    min_score = <span class="number">10000000000000</span></span><br><span class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> node._child():</span><br><span class="line">        <span class="keyword">if</span> has_log:</span><br><span class="line">            score = evaluate_direction_with_log(child, depth * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            score = evaluate_direction(child, depth * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> score &lt; min_score:</span><br><span class="line">            min_score = score</span><br><span class="line">            best_direction = child.from_direction</span><br><span class="line">    <span class="keyword">return</span> best_direction, min_score</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_direction_by_mentcaro</span><span class="params">(node, depth=<span class="number">100</span>, turns=<span class="number">100</span>)</span>:</span></span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(turns):</span><br><span class="line">        new_node = Matrix(node)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(depth):</span><br><span class="line">            new_node._gen_random()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> new_node.check_move():</span><br><span class="line">                score += <span class="number">1000000000</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            direction = random.sample(new_node.ava_move, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            new_node.push(direction)</span><br><span class="line">        score += node.get_score()</span><br><span class="line">    <span class="keyword">return</span> score * <span class="number">1.0</span> / turns</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">direction_dic = &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">"up"</span>,</span><br><span class="line">        <span class="number">1</span>: <span class="string">"right"</span>,</span><br><span class="line">        <span class="number">2</span>: <span class="string">"down"</span>,</span><br><span class="line">        <span class="number">3</span>: <span class="string">"left"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_ai</span><span class="params">()</span>:</span></span><br><span class="line">    n = Matrix()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"start"</span></span><br><span class="line">    <span class="keyword">print</span> n.info()</span><br><span class="line">    turn = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> n.dead:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"#### turn %s ####"</span> % turn</span><br><span class="line">        turn += <span class="number">1</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">30</span></span><br><span class="line">        depth = int(math.sqrt(n.size**<span class="number">2</span> + <span class="number">2</span> - len(n.empty_list)))</span><br><span class="line">        <span class="comment"># depth = 2</span></span><br><span class="line">        <span class="comment"># if len(n.empty_list) &lt; 5:</span></span><br><span class="line">        <span class="comment">#     depth = 3</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"search depth %s"</span> % depth</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            direction, min_score = choose_direction(n, depth)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">print</span> traceback.format_exc()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"#### predict direction is %s ####"</span> % direction_dic[direction]</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"#### best score is %s ####"</span> % min_score</span><br><span class="line">        n.push(direction)</span><br><span class="line">        <span class="keyword">print</span> n.info()</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"#### random gen a unit ####"</span></span><br><span class="line">        n._gen_random()</span><br><span class="line">        <span class="keyword">print</span> n.info()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"done"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="其他AI"><a href="#其他AI" class="headerlink" title="其他AI"></a>其他AI</h2><p>其实我昨晚之后和别人讨论过，然后聊到了蒙特卡洛方法，理论上确实可以，但是我自己用这个代码实现了一下，速度太慢，没法用，python本来就慢，我自己写的也挺渣的T-T，别人动辄10w次的尝试次数完全跑不动，这种狂吃cpu的还是得用c写。</p>
<p>然后上网看了看，还有一种表现很优异的是直接算平均的期望，只不过深度实在比较恐怖，而且因为没法剪枝，计算量非常大，这套实现也是扑街的。</p>
<p>以后的优化方向就是用c重写一个试试看，我自己没到过16384，32768怎么也要让ai到几次 = =</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://migdal-bavel.in.com/2016/07/26/2048-ai小试/" data-id="cir3a922q0000fjs6kayc08y4" class="article-share-link">分享到</a><div class="tags"><a href="/tags/算法/">算法</a><a href="/tags/ai/">ai</a><a href="/tags/博弈/">博弈</a></div><div class="post-nav"><a href="/2016/06/17/logistic分类器/" class="next">logistic分类器</a></div><div data-thread-key="2016/07/26/2048-ai小试/" data-title="2048 ai小试" data-url="http://migdal-bavel.in.com/2016/07/26/2048-ai小试/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/07/26/2048-ai小试/" data-title="2048 ai小试" data-url="http://migdal-bavel.in.com/2016/07/26/2048-ai小试/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/教程/" style="font-size: 15px;">教程</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/博弈/" style="font-size: 15px;">博弈</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/math/" style="font-size: 15px;">math</a> <a href="/tags/machine-learning/" style="font-size: 15px;">machine learning</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/ai/" style="font-size: 15px;">ai</a> <a href="/tags/数据/" style="font-size: 15px;">数据</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/HEXO/" style="font-size: 15px;">HEXO</a> <a href="/tags/建博客/" style="font-size: 15px;">建博客</a> <a href="/tags/Github-Pages/" style="font-size: 15px;">Github Pages</a> <a href="/tags/数独/" style="font-size: 15px;">数独</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/游戏/" style="font-size: 15px;">游戏</a> <a href="/tags/数据挖掘/" style="font-size: 15px;">数据挖掘</a> <a href="/tags/聚类/" style="font-size: 15px;">聚类</a> <a href="/tags/machine-learing/" style="font-size: 15px;">machine learing</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/26/2048-ai小试/">2048 ai小试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/17/logistic分类器/">logistic分类器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/线性回归和梯度下降/">线性回归和梯度下降</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/29/leetcode记/">leetcode记（持续更新中）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/14/数独的高效深度搜索解法/">数独的高效深度搜索解法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/30/python和数据库的接口简介/">python和数据库的接口简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/29/暴力解决三门问题/">暴力解决三门问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/26/让我们来研究一下神奇的连连看/">让我们来研究一下神奇的连连看</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/20/用python实现kmeans算法/">用python实现kmeans算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/22/一定要养成备份文件的好习惯，防止手贱/">一定要养成备份文件的好习惯，防止手贱</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://mathpluscode.com/" title="Pierre Fu 法国逍遥少年" target="_blank">Pierre Fu 法国逍遥少年</a><ul></ul><a href="http://v1ns0n.github.io/" title="v1ns0n 上交苦逼博士" target="_blank">v1ns0n 上交苦逼博士</a><ul></ul><a href="http://xiaoyc.com/" title="xiaoyc 肖大神" target="_blank">xiaoyc 肖大神</a><ul></ul><a href="http://handsomeone.com/" title="周男神" target="_blank">周男神</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">巴别塔.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'migdal-bavel'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d0f9ddc5837fa2c13aa39295424a1eec";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>